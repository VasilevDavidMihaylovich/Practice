//
//  AIResultSheet.swift
//  KFUPractice
//
//  Sheet –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ò–ò
//

import SwiftUI

/// Sheet –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ò–ò –≤ —Ñ–æ—Ä–º–∞—Ç–µ Markdown
struct AIResultSheet: View {
    let result: AIResult
    @Binding var isPresented: Bool
    let onSaveToNotes: (AIResult) -> Void
    
    @Environment(\.dismiss) private var dismiss
    @State private var showSaveAlert = false
    
    var body: some View {
        NavigationView {
            VStack(spacing: 0) {
                // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∏–∫–æ–Ω–∫–æ–π
                headerView
                
                // –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç —Å Markdown
                ScrollView {
                    markdownContent
                        .padding()
                }
                .background(Color(.systemGroupedBackground))
                
                // –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
                actionsView
            }
            .background(Color(.systemBackground))
            .navigationBarHidden(true)
        }
    }
    
    // MARK: - Header
    
    private var headerView: some View {
        VStack(spacing: 12) {
            HStack {
                Button("–ó–∞–∫—Ä—ã—Ç—å") {
                    isPresented = false
                }
                .foregroundColor(.primary)
                
                Spacer()
                
                HStack(spacing: 8) {
                    Image(systemName: result.actionType.icon)
                        .font(.system(size: 16, weight: .medium))
                        .foregroundColor(colorForActionType(result.actionType))
                    
                    Text(result.actionType.displayName)
                        .font(.headline)
                        .foregroundColor(.primary)
                }
                
                Spacer()
                
                Button {
                    onSaveToNotes(result)
                    showSaveAlert = true
                } label: {
                    Image(systemName: "square.and.arrow.down")
                        .font(.system(size: 18, weight: .medium))
                        .foregroundColor(.primary)
                }
            }
            .padding(.horizontal, 16)
            .padding(.top, 12)
            
            Text(result.title)
                .font(.title2)
                .fontWeight(.semibold)
                .multilineTextAlignment(.center)
                .padding(.horizontal, 16)
                .foregroundColor(.primary)
            
            Text("–°–æ–∑–¥–∞–Ω–æ: \(formatDate(result.timestamp))")
                .font(.caption)
                .foregroundColor(.secondary)
                .padding(.bottom, 16)
            
            Divider()
        }
        .background(Color(.systemBackground))
    }
    
    // MARK: - Markdown Content
    
    private var markdownContent: some View {
        VStack(alignment: .leading, spacing: 12) {
            let content = result.content.trimmingCharacters(in: .whitespacesAndNewlines)
            let markdownToDisplay = content.isEmpty ? getMockContentForActionType(result.actionType) : content
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É SwiftUI –¥–ª—è markdown
            // –≠—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç **bold**, *italic*, ~~strikethrough~~ –∏ –¥—Ä—É–≥–∏–µ inline —ç–ª–µ–º–µ–Ω—Ç—ã
            Text(.init(markdownToDisplay))
                .font(.body)
                .lineSpacing(4)
                .textSelection(.enabled) // –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–¥–µ–ª—è—Ç—å –∏ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç
                .foregroundColor(.primary)
        }
        .frame(maxWidth: .infinity, alignment: .leading)
    }
    
    // MARK: - Actions
    
    private var actionsView: some View {
        VStack(spacing: 0) {
            Divider()
            
            HStack(spacing: 16) {
                Button {
                    isPresented = false
                } label: {
                    Text("–ó–∞–∫—Ä—ã—Ç—å")
                        .font(.system(size: 16, weight: .medium))
                        .foregroundColor(.primary)
                        .frame(maxWidth: .infinity)
                        .frame(height: 44)
                        .background(Color(.systemGray6))
                        .cornerRadius(10)
                }
                
                Button {
                    onSaveToNotes(result)
                    showSaveAlert = true
                } label: {
                    Text("–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∑–∞–º–µ—Ç–∫–∏")
                        .font(.system(size: 16, weight: .medium))
                        .foregroundColor(.white)
                        .frame(maxWidth: .infinity)
                        .frame(height: 44)
                        .background(Color.blue)
                        .cornerRadius(10)
                }
            }
            .padding(16)
        }
        .background(Color(.systemBackground))
        .alert("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!", isPresented: $showSaveAlert) {
            Button("OK") { }
        } message: {
            Text("–†–µ–∑—É–ª—å—Ç–∞—Ç –ò–ò —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –∑–∞–º–µ—Ç–∫–∏")
        }
    }
    
    // MARK: - Mock Data Generation
    
    private func getMockContentForActionType(_ actionType: AIActionType) -> String {
        switch actionType {
        case .screenshot:
            return """
# üì∏ –ê–Ω–∞–ª–∏–∑ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–∞–∂–Ω—ã–µ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã, —Ç—Ä–µ–±—É—é—â–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è.

### –ö–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã:
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è** –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤
- **–ü—Ä–∏–º–µ—Ä—ã** –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è  
- **–§–æ—Ä–º—É–ª—ã** –∏ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è
- **–î–∏–∞–≥—Ä–∞–º–º—ã** –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è:
1. –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—á—Ç–∏—Ç–µ –≤—Å–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
2. –†–∞–∑–±–µ—Ä–∏—Ç–µ –∫–∞–∂–¥—ã–π –ø—Ä–∏–º–µ—Ä
3. –ó–∞–ø–æ–º–Ω–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Ñ–æ—Ä–º—É–ª—ã
4. –ü—Ä–æ—Å–ª–µ–¥–∏—Ç–µ –ª–æ–≥–∏—á–µ—Å–∫—É—é —Å–≤—è–∑—å –º–µ–∂–¥—É —Ç–µ–º–∞–º–∏

```
–í–∞–∂–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞ –∏–ª–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
E = mc¬≤
```

> **–°–æ–≤–µ—Ç:** –î–µ–ª–∞–π—Ç–µ –∑–∞–º–µ—Ç–∫–∏ –ø–æ —Ö–æ–¥—É –∏–∑—É—á–µ–Ω–∏—è –¥–ª—è –ª—É—á—à–µ–≥–æ –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è

## –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏:
1. –ö–∞–∫–∏–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã?
2. –ö–∞–∫ –æ–Ω–∏ —Å–≤—è–∑–∞–Ω—ã —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ —Ç–µ–º–∞–º–∏?
3. –ì–¥–µ –º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –∑–Ω–∞–Ω–∏—è?

**–í—Ä–µ–º—è –∏–∑—É—á–µ–Ω–∏—è:** ‚è±Ô∏è 10-15 –º–∏–Ω—É—Ç
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** üìä –°—Ä–µ–¥–Ω—è—è
"""
            
        case .aiNote:
            return """
# üß† –£–º–Ω–∞—è –∑–∞–º–µ—Ç–∫–∞ AI

## –ê–Ω–∞–ª–∏–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞
–í—ã–¥–µ–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ç–µ–º—ã.

### –ì–ª–∞–≤–Ω—ã–µ –∏–¥–µ–∏:
- **–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è** ‚Äî –æ—Å–Ω–æ–≤–∞ –ø–æ–Ω–∏–º–∞–Ω–∏—è
- **–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã** ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
- **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ** ‚Äî –≥–¥–µ –ø—Ä–∏–º–µ–Ω–∏—Ç—å

### –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑:
1. **–ö–æ–Ω—Ç–µ–∫—Å—Ç:** –í —Ä–∞–º–∫–∞—Ö –∫–∞–∫–æ–π –±–æ–ª—å—à–æ–π —Ç–µ–º—ã
2. **–°—É—Ç—å:** –ß—Ç–æ –∏–º–µ–Ω–Ω–æ –æ–±—ä—è—Å–Ω—è–µ—Ç—Å—è
3. **–í–∞–∂–Ω–æ—Å—Ç—å:** –ü–æ—á–µ–º—É —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –∑–Ω–∞—Ç—å
4. **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:** –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ

```
–ö–ª—é—á–µ–≤–∞—è —Ñ–æ—Ä–º—É–ª–∞ –∏–ª–∏ –ø—Ä–∏–Ω—Ü–∏–ø:
–ü—Ä–∏–Ω—Ü–∏–ø –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç–∏: Œîx¬∑Œîp ‚â• ƒß/2
```

> **–ó–∞–ø–æ–º–Ω–∏—Ç–µ:** –≠—Ç–æ—Ç —Ñ—Ä–∞–≥–º–µ–Ω—Ç ‚Äî –æ—Å–Ω–æ–≤–∞ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Å–ª–µ–¥—É—é—â–∏—Ö —Ä–∞–∑–¥–µ–ª–æ–≤

## –°–≤—è–∑–∏ —Å –¥—Ä—É–≥–∏–º–∏ —Ç–µ–º–∞–º–∏:
- **–ù–∞–∑–∞–¥:** ‚Üê –û—Å–Ω–æ–≤–æ–ø–æ–ª–∞–≥–∞—é—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã
- **–°–µ–π—á–∞—Å:** üìç –î–µ—Ç–∞–ª—å–Ω–æ–µ –∏–∑—É—á–µ–Ω–∏–µ
- **–í–ø–µ—Ä–µ–¥:** ‚Üí –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

### –ú–µ—Ç–æ–¥—ã –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è:
- üìù –°–æ—Å—Ç–∞–≤—å—Ç–µ –∫–æ–Ω—Å–ø–µ–∫—Ç –∫–ª—é—á–µ–≤—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤
- üéØ –ù–∞–π–¥–∏—Ç–µ —Å–≤—è–∑–∏ —Å —É–∂–µ –∏–∑—É—á–µ–Ω–Ω—ã–º
- üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤
"""
            
        case .chart:
            return """
# üìä –ê–Ω–∞–ª–∏–∑ –≥—Ä–∞—Ñ–∏–∫–∞ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–π

## –¢–∏–ø –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞
–ì—Ä–∞—Ñ–∏–∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –≤–∞–∂–Ω—ã–µ –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏ –∏ —Ç—Ä–µ–Ω–¥—ã –∏–∑—É—á–∞–µ–º–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥—Ä–∞—Ñ–∏–∫–∞:
- **–û—Å–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:** 
  - X-–æ—Å—å: –ù–µ–∑–∞–≤–∏—Å–∏–º–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è  
  - Y-–æ—Å—å: –ó–∞–≤–∏—Å–∏–º–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è
- **–ú–∞—Å—à—Ç–∞–±:** –ï–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è –∏ –¥–∏–∞–ø–∞–∑–æ–Ω
- **–î–∞–Ω–Ω—ã–µ:** –¢–æ—á–∫–∏, –ª–∏–Ω–∏–∏ —Ç—Ä–µ–Ω–¥–∞, –∞–Ω–æ–º–∞–ª–∏–∏

### –ö–∞–∫ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫:
1. **–ò–∑—É—á–∏—Ç–µ –æ—Å–∏** ‚Äî —á—Ç–æ –æ–Ω–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç
2. **–ù–∞–π–¥–∏—Ç–µ —Ç—Ä–µ–Ω–¥** ‚Äî –æ–±—â–µ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
3. **–í—ã–¥–µ–ª–∏—Ç–µ —ç–∫—Å—Ç—Ä–µ–º—É–º—ã** ‚Äî –º–∞–∫—Å–∏–º—É–º—ã –∏ –º–∏–Ω–∏–º—É–º—ã  
4. **–ò—â–∏—Ç–µ –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏** ‚Äî –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –ø–∞—Ç—Ç–µ—Ä–Ω—ã

```
–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–µ–Ω–¥–∞:
y = f(x) –≥–¥–µ f ‚Äî —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

> **–í–∞–∂–Ω–æ:** –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è –Ω–∞ –æ—Å—è—Ö

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:
- ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã–≤–æ–¥—ã
- üìà –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –∏–∑–º–µ—Ä–µ–Ω–∏—è
- üîÆ –ü–æ–º–æ–≥–∞–µ—Ç –≤ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–∏
- üéØ –í—ã—è–≤–ª—è–µ—Ç —Å–∫—Ä—ã—Ç—ã–µ –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã:
- –ö–∞–∫—É—é –≥–∏–ø–æ—Ç–µ–∑—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –≥—Ä–∞—Ñ–∏–∫?
- –ï—Å—Ç—å –ª–∏ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã?
- –ö–∞–∫ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ?
- –ö–∞–∫–∏–µ –≤—ã–≤–æ–¥—ã –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–ª—è –±—É–¥—É—â–∏—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π?
"""
            
        case .areaSelection:
            return """
# ‚úÇÔ∏è –ê–Ω–∞–ª–∏–∑ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏

## –î–µ—Ç–∞–ª—å–Ω–æ–µ –∏–∑—É—á–µ–Ω–∏–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞
–í—ã–±—Ä–∞–Ω–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, —Ç—Ä–µ–±—É—é—â—É—é –æ—Å–æ–±–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è.

### –ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏–µ:
- **–¢–µ–∫—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç** ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- **–§–æ—Ä–º—É–ª—ã/–≤—ã—Ä–∞–∂–µ–Ω–∏—è** ‚Äî –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è
- **–î–∏–∞–≥—Ä–∞–º–º—ã/—Å—Ö–µ–º—ã** ‚Äî –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
- **–°—Å—ã–ª–∫–∏/—Å–Ω–æ—Å–∫–∏** ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏

### –ü–ª–∞–Ω –∏–∑—É—á–µ–Ω–∏—è –≤—ã–¥–µ–ª–µ–Ω–∏—è:
1. **–ü–µ—Ä–≤–æ–µ —á—Ç–µ–Ω–∏–µ** ‚Äî –æ–±—â–µ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ
2. **–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑** ‚Äî —Ä–∞–∑–±–æ—Ä –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
3. **–°–≤—è–∑–∏** ‚Äî –∫–∞–∫ —Å–æ–æ—Ç–Ω–æ—Å–∏—Ç—Å—è —Å –æ–±—â–µ–π —Ç–µ–º–æ–π
4. **–ü—Ä–∞–∫—Ç–∏–∫–∞** ‚Äî –≥–¥–µ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∑–Ω–∞–Ω–∏—è

```
–§–æ—Ä–º—É–ª–∞ –∏–∑ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞:
‚à´f(x)dx = F(x) + C
```

### –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è:
- üß© –†–∞–∑–±–µ–π—Ç–µ –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ —á–∞—Å—Ç–∏
- üîó –ù–∞–π–¥–∏—Ç–µ —Å–≤—è–∑–∏ —Å —É–∂–µ –∏–∑—É—á–µ–Ω–Ω—ã–º
- üìã –°–æ–∑–¥–∞–π—Ç–µ —Å—Ö–µ–º—É –∏–ª–∏ –∫–∞—Ä—Ç—É –ø–æ–Ω—è—Ç–∏–π
- üéØ –°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ –≥–ª–∞–≤–Ω—É—é –∏–¥–µ—é –æ–¥–Ω–∏–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º

> **–°–æ–≤–µ—Ç:** –≠—Ç–æ—Ç —Ñ—Ä–∞–≥–º–µ–Ω—Ç —á–∞—Å—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –∫–ª—é—á–æ–º –∫ –ø–æ–Ω–∏–º–∞–Ω–∏—é –≤—Å–µ–π —Ç–µ–º—ã

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–Ω–∏–º–∞–Ω–∏—è:
- ‚òëÔ∏è –ú–æ–≥—É –æ–±—ä—è—Å–Ω–∏—Ç—å —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏?
- ‚òëÔ∏è –ü–æ–Ω–∏–º–∞—é –≤—Å–µ —Ç–µ—Ä–º–∏–Ω—ã?
- ‚òëÔ∏è –í–∏–∂—É —Å–≤—è–∑—å —Å –æ–±—â–µ–π —Ç–µ–º–æ–π?
- ‚òëÔ∏è –ó–Ω–∞—é, –≥–¥–µ –ø—Ä–∏–º–µ–Ω–∏—Ç—å?

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** üéì –ì–ª—É–±–æ–∫–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∫–ª—é—á–µ–≤–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞
"""
        }
    }
    
    // MARK: - Helper Methods
    
    private func colorForActionType(_ type: AIActionType) -> Color {
        switch type {
        case .screenshot:
            return .blue
        case .aiNote:
            return .purple
        case .chart:
            return .green
        case .areaSelection:
            return .red
        }
    }
    
    private func formatDate(_ date: Date) -> String {
        let formatter = DateFormatter()
        formatter.dateStyle = .medium
        formatter.timeStyle = .short
        formatter.locale = Locale(identifier: "ru_RU")
        return formatter.string(from: date)
    }
}

#Preview {
    AIResultSheet(
        result: AIResult(
            actionType: .screenshot,
            title: "–ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Markdown",
            content: """
# –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏
–ö–≤–∞–Ω—Ç–æ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞ –æ–ø–∏—Å—ã–≤–∞–µ—Ç **–ø–æ–≤–µ–¥–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∏** –Ω–∞ *–∞—Ç–æ–º–Ω–æ–º —É—Ä–æ–≤–Ω–µ*.

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:
- **–ü—Ä–∏–Ω—Ü–∏–ø –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç–∏** - —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ
- *–í–æ–ª–Ω–æ–≤–∞—è –ø—Ä–∏—Ä–æ–¥–∞ —á–∞—Å—Ç–∏—Ü* - –¥—É–∞–ª–∏–∑–º –≤–æ–ª–Ω–∞-—á–∞—Å—Ç–∏—Ü–∞  
- ~~–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ñ–∏–∑–∏–∫–∞~~ ‚Üí **–ö–≤–∞–Ω—Ç–æ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞**

### –í–∞–∂–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã:
```
E = mc¬≤
ŒîxŒîp ‚â• ƒß/2
```

> **–í–∞–∂–Ω–æ**: –∫–≤–∞–Ω—Ç–æ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞ –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–π —Ñ–∏–∑–∏–∫–∏.

## –í–æ–ø—Ä–æ—Å—ã –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è:
1. –ß—Ç–æ —Ç–∞–∫–æ–µ **–∫–≤–∞–Ω—Ç–æ–≤–∞—è —Å—É–ø–µ—Ä–ø–æ–∑–∏—Ü–∏—è**?
2. –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç *–ø—Ä–∏–Ω—Ü–∏–ø –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç–∏*?
3. –ö–∞–∫–∏–µ **–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è** —É –∫–≤–∞–Ω—Ç–æ–≤–æ–π —Ñ–∏–∑–∏–∫–∏?

**–ó–∞–∫–ª—é—á–µ–Ω–∏–µ**: –∏–∑—É—á–µ–Ω–∏–µ –∫–≤–∞–Ω—Ç–æ–≤–æ–π –º–µ—Ö–∞–Ω–∏–∫–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç *–Ω–æ–≤—ã–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç—ã* –ø–æ–Ω–∏–º–∞–Ω–∏—è –º–∏—Ä–∞.
"""
        ),
        isPresented: .constant(true),
        onSaveToNotes: { _ in }
    )
}